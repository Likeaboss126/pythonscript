import psycopg2

conn = psycopg2.connect(
    host="localhost",
    database="your_db_name",
    user="username",
    password="password"
)
cur = conn.cursor()

failed_log = r"C:\Users\Mudit\Desktop\failed_queries.txt"
open(failed_log, "w").close()  # clear old log

with open(r"C:\Users\Mudit\Desktop\inserts.sql", "r", encoding="utf-8") as f:
    queries = [q.strip() for q in f.read().split(";") if q.strip()]

for i, query in enumerate(queries, 1):
    try:
        cur.execute(query)
        conn.commit()
        print(f"✅ Query {i} succeeded")
    except Exception as e:
        conn.rollback()  # rollback this query
        print(f"❌ Query {i} failed: {e}")
        with open(failed_log, "a", encoding="utf-8") as f_err:
            f_err.write(f"\n--- QUERY #{i} ---\n{query}\nError: {e}\n")

cur.close()
conn.close()
print("All queries processed!")
