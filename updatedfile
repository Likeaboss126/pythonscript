import cv2
import pytesseract
import pandas as pd

# Read image
img = cv2.imread("table_image.jpg")

# Optional: convert to grayscale and threshold for clarity
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
gray = cv2.threshold(gray, 150, 255, cv2.THRESH_BINARY_INV | cv2.THRESH_OTSU)[1]

# OCR with bounding boxes
data = pytesseract.image_to_data(gray, output_type=pytesseract.Output.DATAFRAME)

# Filter out blanks
data = data[data.text.notnull()]

# You can group by 'block_num' or use y-coordinate clustering for rows
rows = []
current_y = None
current_row = []

for i, row in data.iterrows():
    if current_y is None:
        current_y = row['top']
    if abs(row['top'] - current_y) < 15:  # same line tolerance
        current_row.append(row['text'])
    else:
        rows.append(current_row)
        current_row = [row['text']]
        current_y = row['top']

rows.append(current_row)
df = pd.DataFrame(rows)
print(df)
