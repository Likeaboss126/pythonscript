import org.apache.pdfbox.pdmodel.PDDocument;
import org.apache.pdfbox.pdmodel.PDPage;
import org.apache.pdfbox.pdmodel.PDPageContentStream;
import org.apache.pdfbox.pdmodel.graphics.image.PDImageXObject;

import javax.imageio.ImageIO;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.File;
import java.util.Random;

public class RandomNameSignature {
    public static void main(String[] args) throws Exception {
        File inputFile = new File("input.pdf");
        File outputFile = new File("signed_output.pdf");

        try (PDDocument document = PDDocument.load(inputFile)) {
            PDPage page = document.getPage(0); // first page

            // ---- Step 1: Pick a random name ----
            String[] names = {"A. Sharma", "M. Gupta", "R. Verma", "S. Mehta", "K. Patel", "D. Singh"};
            Random rand = new Random();
            String chosenName = names[rand.nextInt(names.length)];

            // ---- Step 2: Generate signature image ----
            int sigWidth = 300, sigHeight = 100;
            BufferedImage sigImage = new BufferedImage(sigWidth, sigHeight, BufferedImage.TYPE_INT_ARGB);
            Graphics2D g2d = sigImage.createGraphics();

            // transparent background
            g2d.setComposite(AlphaComposite.Clear);
            g2d.fillRect(0, 0, sigWidth, sigHeight);
            g2d.setComposite(AlphaComposite.SrcOver);

            // pick a font (script-like if available on system)
            Font font = new Font("Brush Script MT", Font.ITALIC, 48);
            if (font == null) {
                font = new Font("Serif", Font.ITALIC, 48); // fallback
            }

            g2d.setFont(font);
            g2d.setColor(Color.BLACK);
            g2d.drawString(chosenName, 20, sigHeight / 2 + 15);

            g2d.dispose();

            // Save temporary signature file
            File sigFile = new File("temp_signature.png");
            ImageIO.write(sigImage, "png", sigFile);

            // ---- Step 3: Load into PDF ----
            PDImageXObject pdImage = PDImageXObject.createFromFile(sigFile.getAbsolutePath(), document);

            // ---- Step 4: Place inside your box ----
            float xPos = 100;   // left
            float yPos = 150;   // bottom
            float boxWidth = 200;  // fit to box width
            float boxHeight = 50;  // fit to box height

            try (PDPageContentStream contentStream = new PDPageContentStream(document, page,
                    PDPageContentStream.AppendMode.APPEND, true)) {
                contentStream.drawImage(pdImage, xPos, yPos, boxWidth, boxHeight);
            }

            document.save(outputFile);
            System.out.println("✅ Random name signature added → " + chosenName);
            System.out.println("Output PDF → " + outputFile.getAbsolutePath());
        }
    }
}
